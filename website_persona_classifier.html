<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Persona Classifier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6; /* Blue-500 */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-2xl mx-auto p-6 md:p-8 bg-white rounded-2xl shadow-lg">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">Website Persona Classifier</h1>
            <p class="text-gray-600 mt-2">Enter a website URL to classify it into a developer-focused persona.</p>
        </header>

        <div class="flex flex-col md:flex-row items-center gap-4 mb-8">
            <input type="url" id="websiteUrl" placeholder="https://example.com" class="flex-grow w-full px-4 py-3 text-lg bg-gray-100 border-2 border-transparent rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
            <button id="classifyBtn" class="w-full md:w-auto bg-blue-600 text-white font-semibold px-8 py-3 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105 shadow-md">
                Classify
            </button>
        </div>

        <!-- Results Section -->
        <div id="results" class="hidden">
            <div id="loading" class="flex justify-center items-center my-8 hidden">
                <div class="loader"></div>
                <p class="ml-4 text-gray-600">Analyzing website...</p>
            </div>
            
            <div id="output" class="p-6 bg-gray-50 border-2 border-gray-200 rounded-xl hidden">
                <h2 class="text-2xl font-bold text-blue-800 mb-4" id="personaName"></h2>
                <div class="space-y-4">
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Purpose</h3>
                        <p class="text-gray-800 text-lg" id="personaPurpose"></p>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider">Maturity</h3>
                        <p class="text-gray-800 text-lg" id="personaMaturity"></p>
                    </div>
                    <div>
                        <h3 id="techStackLabel" class="text-sm font-semibold text-gray-500 uppercase tracking-wider"></h3>
                        <p class="text-gray-800 text-lg" id="personaTech"></p>
                    </div>
                </div>
            </div>

            <div id="error" class="p-6 bg-red-50 border-2 border-red-200 rounded-xl text-center hidden">
                <h2 class="text-xl font-bold text-red-800">Classification Failed</h2>
                <p class="text-red-700 mt-2" id="errorMessage"></p>
            </div>
        </div>
    </div>

    <script>
        const classifyBtn = document.getElementById('classifyBtn');
        const websiteUrlInput = document.getElementById('websiteUrl');
        const resultsDiv = document.getElementById('results');
        const loadingDiv = document.getElementById('loading');
        const outputDiv = document.getElementById('output');
        const errorDiv = document.getElementById('error');
        
        const personaNameEl = document.getElementById('personaName');
        const personaPurposeEl = document.getElementById('personaPurpose');
        const personaMaturityEl = document.getElementById('personaMaturity');
        const techStackLabelEl = document.getElementById('techStackLabel');
        const personaTechEl = document.getElementById('personaTech');
        const errorMessageEl = document.getElementById('errorMessage');

        const apiKey = ""; 

        const personas = [
            "The Ecosystem Orchestrators",
            "The Content Monarchs",
            "The Social & Creator Platforms",
            "The Transaction Engines",
            "The SaaS Powerhouses",
            "The Information Utilities"
        ];
        
        const personaDefinitions = {
            "The Ecosystem Orchestrators": { purpose: "Platform Integration; API Provisioning; Developer Ecosystems" },
            "The Content Monarchs": { purpose: "Content Publishing; Media Distribution; Advertising" },
            "The Social & Creator Platforms": { purpose: "User-Generated Content; Community Building; Social Networking" },
            "The Transaction Engines": { purpose: "E-commerce; Marketplace Facilitation; Transactional Services" },
            "The SaaS Powerhouses": { purpose: "Business Software; Productivity Tools; B2B Services" },
            "The Information Utilities": { purpose: "Public Information; Government Services; Education" }
        };

        const maturityDefinitions = {
            "Level 1": "Small-scale sites, often personal or community-focused, with simpler tech.",
            "Level 2": "Professional platforms with clear monetization and more robust tech.",
            "Level 3": "Large-scale platforms handling significant user interaction or transactions.",
            "Level 4": "Complex, enterprise-grade solutions where security and scalability are paramount."
        };

        classifyBtn.addEventListener('click', classifyWebsite);
        websiteUrlInput.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
                classifyWebsite();
            }
        });

        async function classifyWebsite() {
            const url = websiteUrlInput.value.trim();
            if (!isValidUrl(url)) {
                showError("Please enter a valid URL (e.g., https://example.com)");
                return;
            }

            hideAll();
            resultsDiv.classList.remove('hidden');
            loadingDiv.classList.remove('hidden');

            try {
                const result = await callGeminiApi(url);
                if (personas.includes(result.persona)) {
                    showResult(result);
                } else {
                    throw new Error(`Model returned an invalid persona: "${result.persona}"`);
                }
            } catch (err) {
                console.error("Classification failed:", err);
                showError("Could not classify the website. The AI model may be unavailable or returned an invalid response.");
            } finally {
                loadingDiv.classList.add('hidden');
            }
        }
        
        function hideAll() {
            loadingDiv.classList.add('hidden');
            outputDiv.classList.add('hidden');
            errorDiv.classList.add('hidden');
        }

        function showError(message) {
            hideAll();
            resultsDiv.classList.remove('hidden');
            errorDiv.classList.remove('hidden');
            errorMessageEl.textContent = message;
        }

        function showResult(data) {
            hideAll();
            resultsDiv.classList.remove('hidden');
            outputDiv.classList.remove('hidden');
            
            const persona = data.persona;
            const definition = personaDefinitions[persona];

            personaNameEl.textContent = persona;
            personaPurposeEl.textContent = definition ? definition.purpose : "No purpose defined.";
            
            const maturityKey = data.maturity;
            const maturityDefinition = maturityDefinitions[maturityKey];
            personaMaturityEl.textContent = `${data.maturity}: ${maturityDefinition || 'No definition available.'}`;

            techStackLabelEl.textContent = data.techStackSource === 'Identified' ? 'Known Tech Stacks' : 'Likely Tech Stacks';
            personaTechEl.textContent = data.techstack;
        }

        function isValidUrl(string) {
            try {
                newUrl = new URL(string);
                return newUrl.protocol === "http:" || newUrl.protocol === "https:";
            } catch (_) {
                return false;
            }
        }

        async function callGeminiApi(url) {
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const systemPrompt = `
                You are a website classification expert. Your task is to analyze a given website URL and classify it into one of the predefined 'Website Personas'.

                You MUST choose one, and only one, of the following persona names:
                - The Ecosystem Orchestrators
                - The Content Monarchs
                - The Social & Creator Platforms
                - The Transaction Engines
                - The SaaS Powerhouses
                - The Information Utilities

                Based on the website's content and apparent complexity, you will return a JSON object with the following structure:
                - "persona": The exact name of the persona you chose from the list.
                - "maturity": Your estimate of the platform's maturity level as a string: "Level 1", "Level 2", "Level 3", or "Level 4".
                - "techstack": A brief list of technologies used (e.g., "React, Node.js, AWS", "Shopify platform", "WordPress with custom plugins").
                - "techStackSource": A string that is either "Identified" or "Inferred". Use "Identified" if you can determine the tech stack from clear source code markers. Use "Inferred" if you are making an educated guess based on the site's functionality.

                Do not add any other text, explanations, or markdown formatting. Your entire response must be a single, valid JSON object.
            `;

            const userQuery = `Classify this website: ${url}`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                generationConfig: {
                  responseMimeType: "application/json",
                  responseSchema: {
                    type: "OBJECT",
                    properties: {
                      "persona": { "type": "STRING", "enum": personas },
                      "maturity": { "type": "STRING", "enum": ["Level 1", "Level 2", "Level 3", "Level 4"] },
                      "techstack": { "type": "STRING" },
                      "techStackSource": { "type": "STRING", "enum": ["Identified", "Inferred"] }
                    },
                    required: ["persona", "maturity", "techstack", "techStackSource"]
                  }
                }
            };
            
            let response;
            let attempts = 0;
            const maxAttempts = 3;
            const initialDelay = 1000;

            while (attempts < maxAttempts) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (response.ok) break;
                } catch (error) {
                   console.error(`Attempt ${attempts + 1} failed with network error`, error);
                }
                attempts++;
                if (attempts < maxAttempts) {
                    await new Promise(resolve => setTimeout(resolve, initialDelay * Math.pow(2, attempts - 1)));
                } else {
                     throw new Error("API request failed after multiple retries.");
                }
            }

            if (!response.ok) {
                throw new Error(`API request failed with status ${response.status}`);
            }

            const result = await response.json();
            const textContent = result.candidates?.[0]?.content?.parts?.[0]?.text;

            if (!textContent) throw new Error("Invalid response structure from API.");

            try {
                return JSON.parse(textContent);
            } catch (e) {
                console.error("Failed to parse JSON response:", textContent);
                throw new Error("Could not understand the classification from the AI model.");
            }
        }
    </script>
</body>
</html>

